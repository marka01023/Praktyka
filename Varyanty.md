```mermaid
graph TD
    A[Начало] --> B[Выбор товаров]
    B --> C{Корзина пуста?}
    C -->|Да| B
    C -->|Нет| D[Оформление заказа]
    D --> E[Ввод данных покупателя]
    E --> F[Выбор способа доставки]
    F --> G[Переход к оплате]
    G --> H{Оплата успешна?}
    H -->|Нет| I[Повторная попытка оплаты]
    I --> G
    H -->|Да| J[Подтверждение оплаты]
    J --> K[Обработка заказа на складе]
    K --> L{Товары в наличии?}
    L -->|Нет| M[Уведомление покупателя]
    M --> N[Возврат средств]
    N --> O[Конец: Заказ отменен]
    L -->|Да| P[Формирование заказа]
    P --> Q[Отправка на доставку]
    Q --> R[Уведомление покупателя]
    R --> S[Конец: Заказ выполнен]
    
    style A fill:#f9f
    style O fill:#f96
    style S fill:#9f9
